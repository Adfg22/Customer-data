<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>بوابة مساهمين الرهوان</title>

<style>
  body {
    font-family: "Cairo", sans-serif;
    background: linear-gradient(135deg, #e6e3f7, #fffaf0);
    padding: 30px;
    color: #333;
    margin: 0;
  }

  .card {
    background: #fff;
    border-radius: 16px;
    padding: 20px 24px;
    margin-bottom: 25px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.12); }

  .card h2, .card h3, .card h4 { margin: 0 0 15px; color: #4b2bcc; }

  input, button {
    padding: 12px 14px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 1rem;
    outline: none;
    transition: all 0.3s;
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 12px;
  }
  input:focus { border-color: #7b3cff; box-shadow: 0 0 8px rgba(123,60,255,0.2); }

  button {
    background: linear-gradient(45deg,#7b3cff,#9d5fff);
    color: #fff;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
  }
  button:hover { background: linear-gradient(45deg,#9d5fff,#7b3cff); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(123,60,255,0.3); }

  .secondary {
    background: #eee;
    color: #333;
    font-weight: normal;
  }
  .secondary:hover { background: #ddd; }

  .badges { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
  .badge { padding: 6px 12px; background: linear-gradient(45deg,#f3f5ff,#e0e4ff); color:#5a2bb3; border-radius: 12px; font-size: 0.9rem; font-weight: 600; box-shadow: 0 2px 8px rgba(90,43,179,0.2); }

  ul { padding-left: 20px; margin: 10px 0; }
  li { margin-bottom: 8px; line-height: 1.5; }
  .muted { color: #777; font-size: 0.9rem; }

  .info-boxes { display:flex; flex-wrap:wrap; gap:15px; margin:15px 0; }
  .box-info { flex:1; min-width:150px; background:#fff; border-radius:12px; padding:16px; text-align:center; box-shadow:0 6px 15px rgba(0,0,0,0.08); }
  .box-info b { display:block; margin-bottom:6px; color:#4b2bcc; }
  .box-info span { font-size:1.1rem; font-weight:bold; color:#333; }

  .features-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:15px; margin-top:15px; }
  .feature-box { background:linear-gradient(135deg,#f9f7ff,#f0f0ff); border:1px solid #ddd; border-radius:14px; padding:14px; display:flex; align-items:center; gap:10px; box-shadow:0 6px 14px rgba(0,0,0,0.06); font-size:0.95rem; font-weight:600; color:#333; }

  /* ✅ كتالوج الاستبدال */
  #redeemPanel { margin-top:20px; padding:16px; background:#fafaff; border:1px solid #ddd; border-radius:12px; box-shadow:0 6px 14px rgba(0,0,0,0.08); }
  .catalog-item { background:#fff; padding:14px; border-radius:10px; margin-bottom:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05); display:flex; justify-content:space-between; align-items:center; }
  .catalog-item b { color:#4b2bcc; display:block; }
  .catalog-item span { color:#333; font-size:0.9rem; }
</style>
</head>
<body>

<div class="card">
  <h2>أدخل ID الخاص بك</h2>
  <input type="text" id="memberIdInput" placeholder="مثال: VIP2025">
  <button onclick="fetchMember()">عرض بياناتي</button>
</div>

<div id="memberPanel" class="card" style="display:none">
  <h3 id="memberName"></h3>
  <div class="muted" id="memberIdLabel"></div>
  <div class="badges" id="memberBadges"></div>
  <hr>

  <div class="info-boxes">
    <div class="box-info"><b>تاريخ الانتهاء</b><span id="endDate"></span></div>
    <div class="box-info"><b>الأيام المتبقية</b><span id="daysLeft"></span></div>
    <div class="box-info"><b>رصيد النقاط</b><span id="points">0</span></div>
  </div>

  <button onclick="openRedeem()">🎯 استبدل النقاط</button>

  <div id="redeemPanel" style="display:none">
    <h4>استبدال النقاط بـ:</h4>
    <div id="catalog"></div>
    <button class="secondary" onclick="closeRedeem()">إغلاق نافذة الاستبدال</button>
  </div>

  <h4>الهدايا والمكافآت:</h4>
  <ul id="giftList"></ul>

  <h4>ميزات المساهم:</h4>
  <div id="featureList" class="features-grid"></div>
</div>

<script>
// =============================
// بيانات عامة
// =============================
const FEATURES = [
  "🎁 خصم 15% على كل طلب لمدة سنة واحدة",
  "🌸 عطر اصلي 50 مل في كل مناسبة (عيد الفطر _ عيد الأضحى _ عيد ميلادك)",
  "💳 كرت عضوية خاص بالمساهم",
  "⚡ أولوية في إنهاء الطلبات",
  "🔄 إمكانية التجديد مقابل مبلغ بسيط كل سنة",
  "🎀 مكافآت مع البكج عند كل طلب",
  "🛍️ هدية ترحيبية عند الاشتراك (3 عبوات عطر 5 مل)",
  "🌟 دعوات خاصة لتجربة عطور VIP قبل نشرها",
  "💎 تجميع نقاط يمكن استبدالها بعطر صغير أو خصم إضافي",
  "📢 إشعار مبكر بالعروض قبل يوم أو يومين"
];

const STORAGE_KEY = "contributors_db_v1";
const CATALOG = [
  { id: 'P_SMALL', name: 'عطر صغير 5 مل', cost: 50, desc: 'عطر صغير يمكن استبداله بالنقاط' },
  { id: 'DISCOUNT_5', name: 'خصم 5% على الطلب', cost: 40, desc: 'خصم إضافي على طلبك التالي' },
  { id: 'GIFT_SET', name: 'باقة هدية (3×5مل)', cost: 120, desc: 'باقة صغيرة ترحيبية' },
  { id: 'FREE_50ML', name: 'عطر أصلي 50 مل (مناسبة)', cost: 400, desc: 'عطر 50 مل لمن تنطبق عليه المناسبة' },
];

// =============================
// دوال مساعدة
// =============================
function formatDateISO(d){
  const dt = new Date(d);
  if(isNaN(dt)) return "-";
  return `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')}`;
}
function daysBetween(from,to){ return Math.ceil((new Date(to)-new Date(from))/(1000*60*60*24)); }
function calcDaysLeft(endDate){
  const today=new Date(); today.setHours(0,0,0,0);
  const end=new Date(endDate); end.setHours(0,0,0,0);
  return daysBetween(today,end);
}
function createBadge(text){ const s=document.createElement("span"); s.className="badge"; s.textContent=text; return s; }

// =============================
// نظام المساهمين
// =============================
let CURRENT_MEMBER=null;

function fetchMember(){
  const id=document.getElementById("memberIdInput").value.trim();
  if(!id){ alert("أدخل ID"); return; }

  fetch("contributors.json")
    .then(res=>res.json())
    .then(DB=>{
      const member=DB.members[id];
      if(!member){ alert("لا توجد بيانات لهذا الـID"); return; }
      CURRENT_MEMBER=member;
      showMember(member);
    })
    .catch(err=>alert("خطأ في تحميل البيانات: "+err));
}

function showMember(member){
  document.getElementById("memberPanel").style.display="block";
  document.getElementById("memberName").textContent=member.name;
  document.getElementById("memberIdLabel").textContent="ID: "+member.id;
  document.getElementById("endDate").textContent=formatDateISO(member.endDate);
  const days=calcDaysLeft(member.endDate);
  document.getElementById("daysLeft").textContent=days>0?days+" يوم":"انتهت الصلاحية";
  document.getElementById("points").textContent=member.points||0;

  const badges=document.getElementById("memberBadges"); badges.innerHTML="";
  if(member.isVIP) badges.appendChild(createBadge("VIP"));
  if(member.invites && member.invites>0) badges.appendChild(createBadge("دعوات VIP: "+member.invites));

  const giftList=document.getElementById("giftList"); giftList.innerHTML="";
  if(member.gifts && member.gifts.length>0){
    member.gifts.forEach(g=>{ const li=document.createElement("li"); li.textContent=g; giftList.appendChild(li); });
  } else giftList.innerHTML="<li>لا توجد هدايا</li>";

  const featureList=document.getElementById("featureList"); featureList.innerHTML="";
  FEATURES.forEach(f=>{
    const div=document.createElement("div"); div.className="feature-box";
    const emojiSpan=document.createElement("span"); emojiSpan.textContent=f.split(" ")[0];
    const textSpan=document.createElement("span"); textSpan.textContent=f.substring(f.indexOf(" ")+1);
    div.appendChild(emojiSpan); div.appendChild(textSpan); featureList.appendChild(div);
  });
}

// =============================
// نظام استبدال النقاط
// =============================
function openRedeem(){
  if(!CURRENT_MEMBER){ alert("ادخل ID أولاً"); return; }
  document.getElementById("redeemPanel").style.display="block";
  const catalogDiv=document.getElementById("catalog");
  catalogDiv.innerHTML="";
  CATALOG.forEach(item=>{
    const div=document.createElement("div");
    div.className="catalog-item";
    div.innerHTML=`<div><b>${item.name}</b><span>${item.desc}</span><br><span>التكلفة: ${item.cost} نقطة</span></div>`;
    const btn=document.createElement("button");
    btn.textContent="استبدل";
    btn.onclick=()=>redeemItem(item);
    div.appendChild(btn);
    catalogDiv.appendChild(div);
  });
}
function closeRedeem(){ document.getElementById("redeemPanel").style.display="none"; }

function redeemItem(item){
  if(CURRENT_MEMBER.points<item.cost){ alert("رصيدك غير كافٍ"); return; }
  CURRENT_MEMBER.points-=item.cost;
  alert("تم استبدال "+item.name+" ✅");
  document.getElementById("points").textContent=CURRENT_MEMBER.points;
}
</script>

</body>
</html>
