<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>بوابة مساهمين الرهوان — VIP Dashboard</title>

<style>
  /* =========================
     Dark Navy + Gold Theme
     ========================= */
  :root{
    --bg: #070816;           /* very dark navy */
    --panel: #0f1724;        /* slightly lighter panel */
    --card: linear-gradient(180deg,#0f1728,#0b1220);
    --muted: #9aa4b2;
    --text: #e6eef6;
    --gold: #d4af37;         /* gold */
    --gold-2: #f0c95a;      /* lighter gold gradient */
    --glass: rgba(255,255,255,0.02);
    --shadow: 0 12px 44px rgba(2,6,23,0.6);
    --radius-lg: 14px;
    --transition: 300ms cubic-bezier(.2,.9,.2,1);
    --max-points: 500; /* default max used for points progress (changeable) */
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Cairo", Inter, "Segoe UI", Roboto, system-ui, -apple-system, sans-serif;
    background: radial-gradient(900px 300px at 10% 10%, rgba(212,175,55,0.03), transparent 12%),
                radial-gradient(800px 260px at 90% 90%, rgba(96,165,250,0.02), transparent 10%),
                var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    display:flex;
    justify-content:center;
  }

  /* container */
  .wrap{ width:100%; max-width:1200px; }

  /* header */
  header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:20px;
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo {
    width:56px;height:56px;border-radius:12px;
    background: linear-gradient(135deg,var(--gold),var(--gold-2));
    display:flex;align-items:center;justify-content:center;color:#071122;font-weight:900;font-size:20px;
    box-shadow: 0 8px 30px rgba(212,175,55,0.12);
  }
  .brand h1{margin:0;font-size:18px;color:var(--text);letter-spacing:0.2px}
  .brand p{margin:0;font-size:12px;color:var(--muted)}

  .header-actions{display:flex;gap:10px;align-items:center}
  .search {
    display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.02);
    border-radius:999px;padding:8px 12px;border:1px solid rgba(255,255,255,0.03);
    min-width:260px;
  }
  .search input{background:transparent;border:0;outline:none;color:var(--text);font-size:14px}

  .toggle-theme{
    padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;background:transparent;color:var(--muted)
  }

  /* layout */
  main.grid{
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:20px;
    align-items:start;
  }

  /* left panel */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius-lg); padding:20px; box-shadow:var(--shadow);
    border:1px solid rgba(255,255,255,0.03);
  }
  .panel h2{margin:0;color:var(--text);font-size:16px}
  .panel p.lead{margin:8px 0 16px;color:var(--muted);font-size:13px}

  .input-wrap input{
    width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
    background: rgba(255,255,255,0.01); color:var(--text); outline:none;
    transition: box-shadow var(--transition), border-color var(--transition);
  }
  .input-wrap input:focus{box-shadow: 0 10px 30px rgba(2,6,23,0.6); border-color: rgba(212,175,55,0.12)}

  .primary-btn{
    margin-top:8px;width:100%;padding:12px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--gold),var(--gold-2));
    color:#071122;font-weight:800;cursor:pointer;box-shadow:0 14px 40px rgba(212,175,55,0.08);
    transition:transform var(--transition);
  }
  .primary-btn:hover{transform:translateY(-4px)}

  .ghost-row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  .ghost-btn{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}

  /* right panel/dashboard */
  .dashboard{display:flex;flex-direction:column;gap:18px}

  /* member card */
  .member-card{
    display:flex;gap:18px;align-items:flex-start;padding:18px;border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03); box-shadow: 0 18px 40px rgba(2,6,23,0.6);
  }
  .member-avatar{
    width:88px;height:88px;border-radius:12px;background:linear-gradient(135deg,#071122,rgba(0,0,0,0.18));
    display:flex;align-items:center;justify-content:center;font-weight:900;font-size:30px;color:var(--gold);
    border: 1px solid rgba(212,175,55,0.08); box-shadow:0 12px 32px rgba(0,0,0,0.6);
    flex-shrink:0;
  }
  .member-info h3{margin:0;font-size:18px;color:var(--text)}
  .member-info .id{margin-top:6px;color:var(--muted);font-size:13px}
  .member-badges{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}

  .stat-row{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap}
  .stat{
    flex:1;min-width:120px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);
    border:1px solid rgba(255,255,255,0.03); text-align:center;
  }
  .stat b{display:block;color:var(--text);font-size:16px}
  .stat span{display:block;color:var(--muted);font-size:12px;margin-top:6px}

  /* progress circles container */
  .progress-wrap{display:flex;gap:16px;align-items:center;margin-left:auto}
  .progress{
    width:86px;height:86px;position:relative;
    display:flex;align-items:center;justify-content:center;
  }
  .progress svg{transform:rotate(-90deg)}
  .progress .label{
    position:absolute;text-align:center;
    color:var(--text);font-weight:800;font-size:12px;
  }
  .progress .sub{display:block;color:var(--muted);font-size:11px;font-weight:600;margin-top:4px}

  /* features */
  .features{
    padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow);
  }
  .features-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .features-grid{
    margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;
  }
  .feature-card{
    display:flex;gap:12px;align-items:flex-start;padding:14px;border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0));
    border:1px solid rgba(255,255,255,0.02); transition: transform var(--transition), box-shadow var(--transition);
    opacity:0; transform:translateY(12px);
  }
  .feature-card:hover{transform:translateY(-6px); box-shadow:0 18px 40px rgba(0,0,0,0.6)}
  .feature-icon{
    width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--gold),var(--gold-2));
    display:flex;align-items:center;justify-content:center;color:#071122;font-weight:900;font-size:18px;
    box-shadow:0 10px 30px rgba(212,175,55,0.08);flex-shrink:0;
  }
  .feature-body h5{margin:0;font-size:14px;color:var(--text)}
  .feature-body p{margin:6px 0 0;color:var(--muted);font-size:12px}

  /* redeem / catalog */
  .redeem{
    padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0));
    border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow)
  }
  .catalog-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
  .catalog-item{
    padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0));
    border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px;opacity:0;transform:translateY(12px)
  }
  .catalog-item h5{margin:0;color:var(--text);font-size:14px}
  .catalog-item p{margin:0;color:var(--muted);font-size:13px}
  .catalog-item .cost{font-weight:900;color:var(--gold)}
  .catalog-item button{margin-top:8px;padding:8px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--gold),var(--gold-2));color:#071122;font-weight:800;cursor:pointer}

  /* gifts panel */
  .gifts{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0));border:1px solid rgba(255,255,255,0.03)}
  .gifts ul{margin:8px 0 0;padding-left:18px;color:var(--muted)}

  /* reveal animation helper (JS sets delay) */
  .reveal{animation:revealUp 560ms cubic-bezier(.2,.9,.2,1) forwards;opacity:0;transform:translateY(14px)}
  @keyframes revealUp{to{opacity:1;transform:translateY(0)}}

  /* responsive */
  @media (max-width:980px){
    main.grid{grid-template-columns:1fr}
    .progress-wrap{display:none}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- header -->
    <header>
      <div class="brand">
        <div class="logo">R</div>
        <div>
          <h1>بوابة مساهمين الرهوان</h1>
          <p class="muted">لوحة تحكم VIP </p>
        </div>
      </div>

      <div class="header-actions">
        <div class="search" title="بحث">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.8">
            <path d="M21 21l-4.35-4.35" stroke="#e6eef6" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="11" cy="11" r="6" stroke="#e6eef6" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input id="headerSearch" placeholder="ابحث باسم أو ID..." aria-label="search" />
        </div>
        <button class="toggle-theme" title="وضع">الوضع: داكن</button>
      </div>
    </header>

    <!-- main -->
    <main class="grid">

      <!-- left panel -->
      <aside class="panel" aria-labelledby="member-search">
        <h2 id="member-search">الوصول السريع للمساهم</h2>
        <p class="lead">ادخل الـ ID لعرض بيانات المساهم. (الوظائف كما هي — قمت بتحديث العرض فقط)</p>

        <div class="input-wrap">
          <input id="memberIdInput" placeholder="مثال: VIP2025" />
        </div>
        <button class="primary-btn" onclick="fetchMember()">عرض بياناتي</button>

        <div class="ghost-row">
          <button class="ghost-btn" onclick="openRedeem()">فتح نافذة الاستبدال</button>
          <button class="ghost-btn" onclick="closeRedeem()">إغلاق نافذة</button>
        </div>
      </aside>

      <!-- right / dashboard -->
      <section class="dashboard">

        <!-- member card -->
        <div id="memberPanel" class="member-card" style="display:none">
          <div class="member-avatar" id="memberAvatar">M</div>
          <div style="flex:1">
            <div class="member-info">
              <h3 id="memberName">اسم المساهم</h3>
              <div class="id" id="memberIdLabel">ID: ---</div>
              <div class="member-badges" id="memberBadges"></div>

              <div class="stat-row">
                <div class="stat">
                  <b id="endDate">----</b>
                  <span>تاريخ الانتهاء</span>
                </div>
                <div class="stat">
                  <b id="daysLeft">--</b>
                  <span>الأيام المتبقية</span>
                </div>
                <div class="stat">
                  <b id="points">0</b>
                  <span>رصيد النقاط</span>
                </div>
              </div>

              <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
                <button class="primary-btn" style="width:auto;padding:10px 14px" onclick="openRedeem()">🎯 استبدل النقاط</button>
                <button class="ghost-btn" onclick="alert('إرسال رسالة تجريبية')">✉️ تواصل</button>

                <!-- progress circles -->
                <div class="progress-wrap" aria-hidden="true">
                  <div class="progress" id="daysProgress">
                    <!-- SVG injected in JS -->
                    <div class="label"><span id="daysPct">0%</span><span class="sub">مدة</span></div>
                  </div>

                  <div class="progress" id="pointsProgress">
                    <div class="label"><span id="pointsPct">0%</span><span class="sub">نقاط</span></div>
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>

        <!-- features -->
        <div class="features">
          <div class="features-head">
            <h4>⭐ ميزات المساهم</h4>
            <div class="muted" style="font-size:13px">تصميم فاخر يليق بمساهمين الرهوان</div>
          </div>

          <div id="featureList" class="features-grid">
            <!-- built by JS -->
          </div>
        </div>

        <!-- redeem / catalog -->
        <div id="redeemPanel" class="redeem" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h4 style="margin:0">🎯 كتالوج الاستبدال</h4>
            <div class="muted" style="font-size:13px">استبدل نقاطك مقابل جوائز</div>
          </div>

          <div id="catalog" class="catalog-grid"></div>
        </div>

        <!-- gifts -->
        <div class="gifts" style="margin-top:6px">
          <h4 style="margin:0 0 8px">🎁 الهدايا والمكافآت</h4>
          <ul id="giftList"></ul>
        </div>

      </section>
    </main>
  </div>

  <!-- ===== JavaScript (وظائف دون تغيير جوهري) ===== -->
  <script>
    /* ========== Data (مثل النسخة السابقة) ========== */
    const CATALOG = [
      { id: 'P_SMALL', name: 'عطر صغير 5 مل', cost: 50, desc: 'عطر صغير يمكن استبداله بالنقاط' },
      { id: 'DISCOUNT_5', name: 'خصم 5% على الطلب', cost: 40, desc: 'خصم إضافي على طلبك التالي' },
      { id: 'GIFT_SET', name: 'باقة هدية (3×5مل)', cost: 120, desc: 'باقة صغيرة ترحيبية' },
      { id: 'FREE_50ML', name: 'عطر أصلي 50 مل (مناسبة)', cost: 400, desc: 'عطر 50 مل لمن تنطبق عليه المناسبة' }
    ];

    const FEATURES = [
      "🎁 خصم 15% على كل طلب لمدة سنة واحدة",
      "🌸 عطر اصلي 50 مل في كل مناسبة (عيد الفطر _ عيد الأضحى _ عيد ميلادك)",
      "💳 كرت عضوية خاص بالمساهم",
      "⚡ أولوية في إنهاء الطلبات",
      "🔄 إمكانية التجديد مقابل مبلغ بسيط كل سنة",
      "🎀 مكافآت مع البكج عند كل طلب",
      "🛍️ هدية ترحيبية عند الاشتراك (3 عبوات عطر 5 مل)",
      "🌟 دعوات خاصة لتجربة عطور VIP قبل نشرها",
      "💎 تجميع نقاط يمكن استبدالها بعطر صغير أو خصم إضافي",
      "📢 إشعار مبكر بالعروض قبل يوم أو يومين"
    ];

    /* ===== Helpers (كما سابقاً + progress calc) ===== */
    function formatDateISO(d){
      const dt = new Date(d); if(isNaN(dt)) return "-";
      return `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')}`;
    }
    function daysBetween(from,to){ const f=new Date(from), t=new Date(to); return Math.ceil((t-f)/(1000*60*60*24)); }
    function calcDaysLeft(endDate){
      const today=new Date(); today.setHours(0,0,0,0); const end=new Date(endDate); end.setHours(0,0,0,0);
      return daysBetween(today,end);
    }

    /* compute percents for progress circles:
       - daysPercent: if member.startDate exists, compute passed/total; otherwise use default base (365 days)
       - pointsPercent: relative to a max (member.pointsMax or root --max-points)
    */
    function computeProgressPercents(member){
      const now = new Date(); let daysLeft = null, daysPercent = 0;
      if(member.endDate){
        const end = new Date(member.endDate);
        daysLeft = calcDaysLeft(member.endDate);
        if(member.startDate){
          const start = new Date(member.startDate);
          const total = Math.max(1, daysBetween(start,end));
          const passed = Math.max(0, Math.min(total, daysBetween(start, now)));
          daysPercent = Math.round((passed / total) * 100);
        } else {
          // fallback: assume a 365-day baseline
          const total = 365;
          const passed = Math.max(0, Math.min(total, 365 - calcDaysLeft(member.endDate)));
          daysPercent = Math.round((passed / total) * 100);
        }
      }
      const points = member.points || 0;
      const maxPoints = member.pointsMax || parseInt(getComputedStyle(document.documentElement).getPropertyValue('--max-points')) || 500;
      const pointsPercent = Math.round(Math.min(100, (points / maxPoints) * 100));
      return { daysLeft, daysPercent, pointsPercent };
    }

    /* ===== Current member holder ===== */
    let CURRENT_MEMBER = null;

    /* ===== Fetch member (unchanged) ===== */
    function fetchMember(){
      const id = document.getElementById("memberIdInput").value.trim();
      if(!id){ alert("أدخل ID"); return; }

      fetch("contributors.json")
        .then(res => res.json())
        .then(DB => {
          const member = DB.members[id];
          if(!member){ alert("لا توجد بيانات لهذا الـID"); return; }
          CURRENT_MEMBER = member;
          showMember(member);
        })
        .catch(err => alert("خطأ في تحميل البيانات: " + err));
    }

    /* ===== showMember (renders UI, progress circles, features, catalog) ===== */
    function showMember(member){
      // show container
      const panel = document.getElementById("memberPanel");
      panel.style.display = "flex";

      // basic info
      document.getElementById("memberName").textContent = member.name;
      document.getElementById("memberIdLabel").textContent = "ID: " + member.id;
      document.getElementById("endDate").textContent = formatDateISO(member.endDate);

      const days = calcDaysLeft(member.endDate);
      document.getElementById("daysLeft").textContent = (days > 0 ? days + " يوم" : "انتهت الصلاحية");
      document.getElementById("points").textContent = member.points || 0;

      // avatar initial
      const avatar = document.getElementById("memberAvatar");
      avatar.textContent = (member.name ? member.name.charAt(0) : 'M').toUpperCase();

      // badges
      const badgeWrap = document.getElementById("memberBadges");
      badgeWrap.innerHTML = "";
      if(member.isVIP) badgeWrap.appendChild(createBadge("VIP"));
      if(member.invites && member.invites > 0) badgeWrap.appendChild(createBadge("دعوات VIP: " + member.invites));

      // gifts
      const giftList = document.getElementById("giftList");
      giftList.innerHTML = "";
      if(member.gifts && member.gifts.length > 0){
        member.gifts.forEach(g=>{
          const li = document.createElement("li");
          li.textContent = g;
          giftList.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.textContent = "لا توجد هدايا";
        giftList.appendChild(li);
      }

      // features with staggered reveal
      const featureList = document.getElementById("featureList");
      featureList.innerHTML = "";
      FEATURES.forEach((f, i) => {
        const card = document.createElement("div");
        card.className = "feature-card reveal";
        card.style.animationDelay = (i * 80) + "ms";

        const icon = document.createElement("div");
        icon.className = "feature-icon";
        icon.textContent = f.split(" ")[0];

        const body = document.createElement("div");
        body.className = "feature-body";
        const title = document.createElement("h5");
        title.textContent = f.substring(f.indexOf(" ")+1);
        const desc = document.createElement("p");
        desc.textContent = ""; // optional description
        body.appendChild(title);
        body.appendChild(desc);

        card.appendChild(icon);
        card.appendChild(body);
        featureList.appendChild(card);
      });

      // render catalog
      renderCatalog(member);

      // render progress circles
      renderProgress(member);

      // scroll to panel smoothly for UX
      setTimeout(()=> panel.scrollIntoView({behavior:'smooth', block:'center'}), 180);
    }

    function createBadge(text){
      const el = document.createElement("span");
      el.style.padding = "6px 10px";
      el.style.background = "linear-gradient(90deg, rgba(212,175,55,0.12), rgba(240,201,90,0.06))";
      el.style.border = "1px solid rgba(212,175,55,0.06)";
      el.style.borderRadius = "8px";
      el.style.fontWeight = "700";
      el.style.color = "#f7f1d6";
      el.style.fontSize = "12px";
      el.textContent = text;
      return el;
    }

    /* ===== render catalog (unchanged logic visually improved) ===== */
    function renderCatalog(member){
      const c = document.getElementById("catalog");
      c.innerHTML = "";
      CATALOG.forEach((item, idx) => {
        const box = document.createElement("div");
        box.className = "catalog-item reveal";
        box.style.animationDelay = (idx * 90) + "ms";

        const h = document.createElement("h5"); h.textContent = item.name;
        const p = document.createElement("p"); p.textContent = item.desc;
        const cost = document.createElement("div"); cost.className = "cost"; cost.textContent = item.cost + " نقطة";

        const btn = document.createElement("button");
        btn.textContent = "استبدل الآن";
        btn.onclick = () => redeemItem(member, item);

        box.appendChild(h); box.appendChild(p); box.appendChild(cost); box.appendChild(btn);
        c.appendChild(box);
      });
    }

    /* ===== redeem flow (same logic) ===== */
    function redeemItem(member, item){
      if((member.points || 0) < item.cost){ alert("رصيدك غير كافٍ للاستبدال!"); return; }
      member.points -= item.cost;
      document.getElementById("points").textContent = member.points;
      // update progress circles visually
      renderProgress(member);
      alert("✅ تم استبدال " + item.name + " بنجاح!");
    }

    /* ===== Progress circles rendering ===== */
    function renderProgress(member){
      // compute percents
      const { daysLeft, daysPercent, pointsPercent } = computeProgressPercents(member);

      // days circle
      const daysWrap = document.getElementById("daysProgress");
      daysWrap.innerHTML = ''; // clear previous
      const svgDays = buildCircleSVG(40, '#11182733', 'var(--gold)', daysPercent);
      daysWrap.appendChild(svgDays);
      document.getElementById("daysPct").textContent = daysPercent + "%";
      // update sublabel
      const daysSub = daysLeft !== null ? (daysLeft > 0 ? daysLeft + " يوم" : "منتهية") : '-';
      // small accessible sub-line
      const daysLabel = daysWrap.querySelector('.label');
      if(daysLabel) daysLabel.innerHTML = `<span id="daysPct">${daysPercent}%</span><span class="sub">${daysSub}</span>`;

      // points circle
      const ptsWrap = document.getElementById("pointsProgress");
      ptsWrap.innerHTML = '';
      const svgPts = buildCircleSVG(40, '#11182733', 'var(--gold)', pointsPercent);
      ptsWrap.appendChild(svgPts);
      document.getElementById("pointsPct").textContent = pointsPercent + "%";
      const ptsLabel = ptsWrap.querySelector('.label');
      if(ptsLabel) ptsLabel.innerHTML = `<span id="pointsPct">${pointsPercent}%</span><span class="sub">${member.points || 0} نقطة</span>`;
    }

    // helper builds an SVG circular progress (radius r, bgColor, strokeColor, percent)
    function buildCircleSVG(r, bgColor, strokeCSSVar, percent){
      const size = (r * 2) + 6; // padding for stroke
      const strokeWidth = 6;
      const radius = r;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference * (1 - (Math.max(0, Math.min(100, percent)) / 100));
      // create svg
      const ns = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(ns, "svg");
      svg.setAttribute("width", size);
      svg.setAttribute("height", size);
      svg.setAttribute("viewBox", `0 0 ${size} ${size}`);
      // background circle
      const bg = document.createElementNS(ns, "circle");
      bg.setAttribute("cx", size/2);
      bg.setAttribute("cy", size/2);
      bg.setAttribute("r", radius);
      bg.setAttribute("fill", "none");
      bg.setAttribute("stroke", bgColor);
      bg.setAttribute("stroke-width", strokeWidth);
      // foreground
      const fg = document.createElementNS(ns, "circle");
      fg.setAttribute("cx", size/2);
      fg.setAttribute("cy", size/2);
      fg.setAttribute("r", radius);
      fg.setAttribute("fill", "none");
      fg.setAttribute("stroke", "url(#goldGrad-"+Math.random().toString(36).slice(2,8)+")"); // gradient id unique
      fg.setAttribute("stroke-width", strokeWidth);
      fg.setAttribute("stroke-linecap", "round");
      fg.setAttribute("stroke-dasharray", circumference);
      fg.setAttribute("stroke-dashoffset", circumference);
      // group defs for gradient
      const defs = document.createElementNS(ns, "defs");
      const grad = document.createElementNS(ns, "linearGradient");
      const gid = "goldGrad-"+Math.random().toString(36).slice(2,8);
      grad.setAttribute("id", gid);
      grad.setAttribute("x1","0%"); grad.setAttribute("x2","100%");
      const stop1 = document.createElementNS(ns, "stop"); stop1.setAttribute("offset","0%"); stop1.setAttribute("stop-color", getComputedStyle(document.documentElement).getPropertyValue('--gold').trim() || '#d4af37');
      const stop2 = document.createElementNS(ns, "stop"); stop2.setAttribute("offset","100%"); stop2.setAttribute("stop-color", getComputedStyle(document.documentElement).getPropertyValue('--gold-2').trim() || '#f0c95a');
      grad.appendChild(stop1); grad.appendChild(stop2);
      defs.appendChild(grad);
      fg.setAttribute("stroke", `url(#${gid})`);

      svg.appendChild(defs);
      svg.appendChild(bg);
      svg.appendChild(fg);

      // animate stroke dashoffset smoothly
      requestAnimationFrame(() => {
        fg.style.transition = "stroke-dashoffset 700ms cubic-bezier(.2,.9,.2,1)";
        fg.style.strokeDashoffset = offset;
      });

      // label overlay
      const label = document.createElement("div");
      label.className = "label";
      label.style.position = "absolute";
      label.style.left = "50%";
      label.style.top = "50%";
      label.style.transform = "translate(-50%,-50%)";
      label.style.textAlign = "center";
      label.style.color = "var(--text)";
      label.style.fontWeight = "800";
      label.innerHTML = `<span style="font-size:12px">${percent}%</span><span style="display:block;font-size:11px;color:var(--muted);margin-top:4px"></span>`;

      const wrapper = document.createElement("div");
      wrapper.style.position = "relative";
      wrapper.style.width = size + "px";
      wrapper.style.height = size + "px";
      wrapper.appendChild(svg);
      wrapper.appendChild(label);

      return wrapper;
    }

    /* ===== header search quick hook (non-invasive) ===== */
    document.getElementById("headerSearch").addEventListener("keydown", function(e){
      if(e.key === "Enter"){
        const q = this.value.trim();
        if(!q) return;
        document.getElementById("memberIdInput").value = q;
        fetchMember();
      }
    });

    /* ===== open/close redeem panel ===== */
    function openRedeem(){
      if(!CURRENT_MEMBER){ alert("ادخل ID أولاً"); return; }
      document.getElementById("redeemPanel").style.display = "block";
      document.getElementById("redeemPanel").scrollIntoView({behavior:'smooth', block:'center'});
    }
    function closeRedeem(){
      document.getElementById("redeemPanel").style.display = "none";
    }

    /* ===== Example: If you want to auto-load a sample member for preview, uncomment: =====
    window.addEventListener('DOMContentLoaded', () => {
      // fetchMember(); // or showMember(sampleMemberObject)
    });
    */

  </script>
</body>
</html>

